<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±–ª—ñ–∫ —Ä–æ–±–æ—á–∏—Ö –≥–æ–¥–∏–Ω</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .month-selector {
            padding: 20px 30px;
            background: white;
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            border-bottom: 2px solid #e9ecef;
        }

        .month-selector label {
            font-weight: 600;
            color: #495057;
        }

        .month-selector select,
        .month-selector input {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .month-selector select:focus,
        .month-selector input:focus {
            outline: none;
            border-color: #667eea;
        }

        .month-selector input[type="number"] {
            width: 120px;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            border-bottom: 2px solid #e9ecef;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-info {
            background: #3b82f6;
            color: white;
        }

        .btn-info:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #10b981;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.error {
            background: #ef4444;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .table-container {
            padding: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .weekend {
            background: #fee;
        }

        .weekend:hover {
            background: #fdd;
        }

        input[type="time"],
        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .hours-cell {
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
        }

        .total-row {
            background: #f8f9fa;
            font-weight: bold;
            font-size: 18px;
        }

        .total-row td {
            padding: 20px 10px;
            border-top: 3px solid #667eea;
        }

        .total-hours {
            color: #667eea;
            font-size: 24px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            color: #667eea;
            font-size: 32px;
            font-weight: bold;
        }

        .stat-card.success .value {
            color: #10b981;
        }

        .stat-card.warning .value {
            color: #f59e0b;
        }

        .stat-card.danger .value {
            color: #ef4444;
        }

        .footer {
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            color: #6c757d;
            font-size: 14px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .controls, .btn, .month-selector {
                display: none !important;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –û–±–ª—ñ–∫ —Ä–æ–±–æ—á–æ–≥–æ —á–∞—Å—É</h1>
            <p id="headerMonth">–°—ñ—á–µ–Ω—å 2026</p>
        </div>

        <div class="month-selector">
            <label for="monthSelect">–ú—ñ—Å—è—Ü—å:</label>
            <select id="monthSelect" onchange="changeMonth()">
                <option value="0">–°—ñ—á–µ–Ω—å</option>
                <option value="1">–õ—é—Ç–∏–π</option>
                <option value="2">–ë–µ—Ä–µ–∑–µ–Ω—å</option>
                <option value="3">–ö–≤—ñ—Ç–µ–Ω—å</option>
                <option value="4">–¢—Ä–∞–≤–µ–Ω—å</option>
                <option value="5">–ß–µ—Ä–≤–µ–Ω—å</option>
                <option value="6">–õ–∏–ø–µ–Ω—å</option>
                <option value="7">–°–µ—Ä–ø–µ–Ω—å</option>
                <option value="8">–í–µ—Ä–µ—Å–µ–Ω—å</option>
                <option value="9">–ñ–æ–≤—Ç–µ–Ω—å</option>
                <option value="10">–õ–∏—Å—Ç–æ–ø–∞–¥</option>
                <option value="11">–ì—Ä—É–¥–µ–Ω—å</option>
            </select>

            <label for="yearSelect">–†—ñ–∫:</label>
            <select id="yearSelect" onchange="changeMonth()">
                <option value="2025">2025</option>
                <option value="2026" selected>2026</option>
                <option value="2027">2027</option>
                <option value="2028">2028</option>
            </select>

            <label for="minHours">–ú—ñ–Ω—ñ–º—É–º –≥–æ–¥–∏–Ω –Ω–∞ –º—ñ—Å—è—Ü—å:</label>
            <input type="number" id="minHours" value="160" min="0" step="1" onchange="updateStats()">
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="saveData()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ</button>
            <button class="btn btn-success" id="googleBtn" onclick="connectGoogle()">üîó –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ Google Sheets</button>
            <button class="btn btn-success" id="syncBtn" onclick="syncToGoogle()" style="display:none">‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑ Google</button>
            <button class="btn btn-success" onclick="exportToCSV()">üì• –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
            <button class="btn btn-info" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>–í—Å—å–æ–≥–æ –≥–æ–¥–∏–Ω</h3>
                <div class="value" id="totalHours">0</div>
            </div>
            <div class="stat-card">
                <h3>–†–æ–±–æ—á–∏—Ö –¥–Ω—ñ–≤</h3>
                <div class="value" id="workDays">0</div>
            </div>
            <div class="stat-card" id="minHoursCard">
                <h3>–ú—ñ–Ω—ñ–º—É–º –Ω–∞ –º—ñ—Å—è—Ü—å</h3>
                <div class="value" id="minHoursDisplay">160</div>
            </div>
            <div class="stat-card" id="remainingCard">
                <h3>–ó–∞–ª–∏—à–∏–ª–æ—Å—å –≥–æ–¥–∏–Ω</h3>
                <div class="value" id="remainingHours">160</div>
            </div>
        </div>

        <div class="table-container">
            <table id="timeTable">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î–µ–Ω—å —Ç–∏–∂–Ω—è</th>
                        <th>–ü–æ—á–∞—Ç–æ–∫</th>
                        <th>–ö—ñ–Ω–µ—Ü—å</th>
                        <th>–ü–∞—É–∑–∞ –ø–æ—á–∞—Ç–æ–∫</th>
                        <th>–ü–∞—É–∑–∞ –∫—ñ–Ω–µ—Ü—å</th>
                        <th>–í—Å—å–æ–≥–æ –≥–æ–¥–∏–Ω</th>
                        <th>–ü—Ä–∏–º—ñ—Ç–∫–∏</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>

        <div class="footer">
            üí° <strong>–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è:</strong> –î–∞–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ. –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ Google Sheets –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ "‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏" –∞–±–æ –µ–∫—Å–ø–æ—Ä—Ç CSV.
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjusHy-xqg8FA8LjsGHK8DJFm4eJppDHM",
            authDomain: "work-time-a7236.firebaseapp.com",
            databaseURL: "https://work-time-a7236-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "work-time-a7236",
            storageBucket: "work-time-a7236.firebasestorage.app",
            messagingSenderId: "68175538100",
            appId: "1:68175538100:web:bdb96fe020af7c3e59f4e1"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // –ï–∫—Å–ø–æ—Ä—Ç –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;
    </script>
    
    <script>
        const daysOfWeek = ['–ù–µ–¥—ñ–ª—è', '–ü–æ–Ω–µ–¥—ñ–ª–æ–∫', '–í—ñ–≤—Ç–æ—Ä–æ–∫', '–°–µ—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä', '–ü\'—è—Ç–Ω–∏—Ü—è', '–°—É–±–æ—Ç–∞'];
        const monthNames = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];
        
        let currentMonth = 0;
        let currentYear = 2026;
        let firebaseSyncEnabled = true; // Firebase –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —É–≤—ñ–º–∫–Ω–µ–Ω–∞

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = async function() {
            // –ß–µ–∫–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Firebase
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Firebase
            await checkFirebaseConnection();
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –∑ Firebase –∞–±–æ –ª–æ–∫–∞–ª—å–Ω–æ
            await initTable();
        };

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase
        async function checkFirebaseConnection() {
            console.log('–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase...');
            try {
                if (window.firebaseDB) {
                    // –¢–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø–∏—Ç –¥–æ Firebase
                    const testRef = window.firebaseRef(window.firebaseDB, 'test');
                    await window.firebaseSet(testRef, { connected: true, time: Date.now() });
                    
                    firebaseSyncEnabled = true;
                    const btn = document.getElementById('googleBtn');
                    if (btn) {
                        btn.textContent = '‚úì Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ';
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-primary');
                    }
                    console.log('Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!');
                    showNotification('‚úì Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ! –î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ');
                } else {
                    throw new Error('Firebase –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                }
            } catch (error) {
                console.warn('Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –ø—Ä–∞—Ü—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ', error);
                firebaseSyncEnabled = false;
                showNotification('‚ÑπÔ∏è –ü—Ä–∞—Ü—é—î–º–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ');
            }
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞–±–ª–∏—Ü—ñ
        async function initTable() {
            const month = parseInt(document.getElementById('monthSelect').value);
            const year = parseInt(document.getElementById('yearSelect').value);
            
            currentMonth = month;
            currentYear = year;

            document.getElementById('headerMonth').textContent = `${monthNames[month]} ${year}`;

            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayOfWeek = daysOfWeek[date.getDay()];
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;

                const row = document.createElement('tr');
                if (isWeekend) row.classList.add('weekend');
                row.dataset.day = day;

                const monthStr = String(month + 1).padStart(2, '0');
                const dayStr = String(day).padStart(2, '0');

                row.innerHTML = `
                    <td>${dayStr}.${monthStr}.${year}</td>
                    <td>${dayOfWeek}</td>
                    <td><input type="time" class="start-time" value="" onchange="calculateHours(${day}); autoSync()"></td>
                    <td><input type="time" class="end-time" value="" onchange="calculateHours(${day}); autoSync()"></td>
                    <td><input type="time" class="break-start" value="" onchange="calculateHours(${day}); autoSync()"></td>
                    <td><input type="time" class="break-end" value="" onchange="calculateHours(${day}); autoSync()"></td>
                    <td class="hours-cell" id="hours-${day}">0</td>
                    <td><input type="text" class="notes" placeholder="${isWeekend ? '–í–∏—Ö—ñ–¥–Ω–∏–π' : ''}" onchange="autoSync()"></td>
                `;

                tbody.appendChild(row);
            }

            await loadData();
            calculateAllHours();
        }

        // –ó–º—ñ–Ω–∞ –º—ñ—Å—è—Ü—è
        function changeMonth() {
            saveData();
            initTable();
        }

        // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≥–æ–¥–∏–Ω –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–Ω—è
        function calculateHours(day) {
            const row = document.querySelector(`tr[data-day="${day}"]`);
            if (!row) return;
            
            const startTime = row.querySelector('.start-time').value;
            const endTime = row.querySelector('.end-time').value;
            const breakStart = row.querySelector('.break-start').value;
            const breakEnd = row.querySelector('.break-end').value;
            
            let breakHours = 0;
            if (breakStart && breakEnd) {
                const [bsH, bsM] = breakStart.split(':').map(Number);
                const [beH, beM] = breakEnd.split(':').map(Number);
                breakHours = ((beH * 60 + beM) - (bsH * 60 + bsM)) / 60;
            }
            const breakTime = breakHours;

            if (!startTime || !endTime) {
                document.getElementById(`hours-${day}`).textContent = '0';
                updateStats();
                return;
            }

            const start = new Date(`2000-01-01T${startTime}`);
            const end = new Date(`2000-01-01T${endTime}`);
            
            let hours = (end - start) / (1000 * 60 * 60);
            hours -= breakTime;

            if (hours < 0) hours = 0;

            document.getElementById(`hours-${day}`).textContent = hours.toFixed(2);
            updateStats();
            saveData();
            autoSync(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        }

        // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤—Å—ñ—Ö –≥–æ–¥–∏–Ω
        function calculateAllHours() {
            const month = parseInt(document.getElementById('monthSelect').value);
            const year = parseInt(document.getElementById('yearSelect').value);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                calculateHours(day);
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            let totalHours = 0;
            let workDays = 0;

            for (let day = 1; day <= daysInMonth; day++) {
                const hoursEl = document.getElementById(`hours-${day}`);
                if (hoursEl) {
                    const hours = parseFloat(hoursEl.textContent) || 0;
                    if (hours > 0) {
                        totalHours += hours;
                        workDays++;
                    }
                }
            }

            const minHours = parseFloat(document.getElementById('minHours').value) || 0;
            const remaining = minHours - totalHours;

            document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            document.getElementById('workDays').textContent = workDays;
            document.getElementById('minHoursDisplay').textContent = minHours;
            document.getElementById('remainingHours').textContent = remaining > 0 ? remaining.toFixed(1) : '0';

            const remainingCard = document.getElementById('remainingCard');
            remainingCard.classList.remove('success', 'warning', 'danger');
            
            if (remaining <= 0) {
                remainingCard.classList.add('success');
            } else if (remaining <= minHours * 0.2) {
                remainingCard.classList.add('warning');
            } else {
                remainingCard.classList.add('danger');
            }
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        async function saveData() {
            const month = parseInt(document.getElementById('monthSelect').value);
            const year = parseInt(document.getElementById('yearSelect').value);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const data = [];
            const rows = [];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const row = document.querySelector(`tr[data-day="${day}"]`);
                if (row) {
                    const date = new Date(year, month, day);
                    const dayOfWeek = daysOfWeek[date.getDay()];
                    const monthStr = String(month + 1).padStart(2, '0');
                    const dayStr = String(day).padStart(2, '0');
                    const dateStr = `${dayStr}.${monthStr}.${year}`;
                    
                    const start = row.querySelector('.start-time').value;
                    const end = row.querySelector('.end-time').value;
                    const breakStart = row.querySelector('.break-start').value;
                    const breakEnd = row.querySelector('.break-end').value;
                    const hours = document.getElementById(`hours-${day}`).textContent;
                    const notes = row.querySelector('.notes').value;
                    
                    data.push({
                        start: start,
                        end: end,
                        breakStart: breakStart,
                        breakEnd: breakEnd,
                        notes: notes
                    });
                    
                    rows.push([dateStr, dayOfWeek, start, end, breakStart, breakEnd, hours, notes]);
                }
            }
            
            const minHours = document.getElementById('minHours').value;
            
            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ
            const storageKey = `timeTracking_${year}_${String(month + 1).padStart(2, '0')}`;
            localStorage.setItem(storageKey, JSON.stringify(data));
            localStorage.setItem(`${storageKey}_minHours`, minHours);
            
            // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Firebase
            if (firebaseSyncEnabled) {
                await saveToFirebase(month, year, rows);
            }
            
            const btn = event?.target;
            if (btn) {
                const originalText = btn.textContent;
                btn.textContent = '‚úì –ó–±–µ—Ä–µ–∂–µ–Ω–æ!';
                setTimeout(() => btn.textContent = originalText, 2000);
            }
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Firebase
        async function saveToFirebase(month, year, rows) {
            try {
                if (!window.firebaseDB || !firebaseSyncEnabled) {
                    console.log('Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é');
                    return;
                }
                
                console.log('–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Firebase:', monthNames[month], year, rows.length, '—Ä—è–¥–∫—ñ–≤');
                const dataRef = window.firebaseRef(window.firebaseDB, `timeTracking/${year}/${month}`);
                await window.firebaseSet(dataRef, {
                    month: monthNames[month],
                    year: year,
                    rows: rows,
                    updatedAt: Date.now()
                });
                
                console.log('‚úì –î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ Firebase');
            } catch (error) {
                console.warn('–ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ Firebase:', error);
            }
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        async function loadData() {
            const month = parseInt(document.getElementById('monthSelect').value);
            const year = parseInt(document.getElementById('yearSelect').value);
            const storageKey = `timeTracking_${year}_${String(month + 1).padStart(2, '0')}`;
            
            // –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ Firebase
            if (firebaseSyncEnabled) {
                const firebaseData = await loadFromFirebase(month, year);
                if (firebaseData && firebaseData.length > 0) {
                    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ Firebase
                    firebaseData.forEach((item, index) => {
                        const day = index + 1;
                        const row = document.querySelector(`tr[data-day="${day}"]`);
                        if (row && item.length >= 8) {
                            row.querySelector('.start-time').value = item[2] || '';
                            row.querySelector('.end-time').value = item[3] || '';
                            row.querySelector('.break-start').value = item[4] || '';
                            row.querySelector('.break-end').value = item[5] || '';
                            row.querySelector('.notes').value = item[7] || '';
                        }
                    });
                    calculateAllHours();
                    return;
                }
            }
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage —è–∫—â–æ Google –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π
            const saved = localStorage.getItem(storageKey);
            const savedMinHours = localStorage.getItem(`${storageKey}_minHours`);
            
            if (savedMinHours) {
                document.getElementById('minHours').value = savedMinHours;
            }
            
            if (!saved) return;

            const data = JSON.parse(saved);
            data.forEach((item, index) => {
                const day = index + 1;
                const row = document.querySelector(`tr[data-day="${day}"]`);
                if (row) {
                    row.querySelector('.start-time').value = item.start || '';
                    row.querySelector('.end-time').value = item.end || '';
                    row.querySelector('.break-start').value = item.breakStart || '';
                    row.querySelector('.break-end').value = item.breakEnd || '';
                    row.querySelector('.notes').value = item.notes || '';
                }
            });
            calculateAllHours();
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Firebase
        async function loadFromFirebase(month, year) {
            try {
                if (!window.firebaseDB || !firebaseSyncEnabled) {
                    console.log('Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ');
                    return null;
                }
                
                console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Firebase:', monthNames[month], year);
                const dataRef = window.firebaseRef(window.firebaseDB, `timeTracking/${year}/${month}`);
                const snapshot = await window.firebaseGet(dataRef);
                
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –∑ Firebase:', data);
                    return data.rows || null;
                }
            } catch (error) {
                console.warn('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ Firebase:', error);
            }
            return null;
        }

        // –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportToCSV() {
            const month = parseInt(document.getElementById('monthSelect').value);
            const year = parseInt(document.getElementById('yearSelect').value);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let csv = '–î–∞—Ç–∞,–î–µ–Ω—å —Ç–∏–∂–Ω—è,–ü–æ—á–∞—Ç–æ–∫,–ö—ñ–Ω–µ—Ü—å,–ü–∞—É–∑–∞ –ø–æ—á–∞—Ç–æ–∫,–ü–∞—É–∑–∞ –∫—ñ–Ω–µ—Ü—å,–í—Å—å–æ–≥–æ –≥–æ–¥–∏–Ω,–ü—Ä–∏–º—ñ—Ç–∫–∏\n';
            
            for (let day = 1; day <= daysInMonth; day++) {
                const row = document.querySelector(`tr[data-day="${day}"]`);
                if (row) {
                    const monthStr = String(month + 1).padStart(2, '0');
                    const dayStr = String(day).padStart(2, '0');
                    const date = `${dayStr}.${monthStr}.${year}`;
                    const dayOfWeek = daysOfWeek[new Date(year, month, day).getDay()];
                    const start = row.querySelector('.start-time').value;
                    const end = row.querySelector('.end-time').value;
                    const breakStart = row.querySelector('.break-start').value;
                    const breakEnd = row.querySelector('.break-end').value;
                    const hours = document.getElementById(`hours-${day}`).textContent;
                    const notes = row.querySelector('.notes').value;

                    csv += `${date},${dayOfWeek},${start},${end},${breakStart},${breakEnd},${hours},"${notes}"\n`;
                }
            }

            const totalHours = document.getElementById('totalHours').textContent;
            const minHours = document.getElementById('minHours').value;
            csv += `\n,,,,,,${totalHours},–í—Å—å–æ–≥–æ –≥–æ–¥–∏–Ω –∑–∞ –º—ñ—Å—è—Ü—å\n`;
            csv += `,,,,,,${minHours},–ú—ñ–Ω—ñ–º—É–º –≥–æ–¥–∏–Ω\n`;

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `–û–±–ª—ñ–∫_—Ä–æ–±–æ—á–æ–≥–æ_—á–∞—Å—É_${monthNames[month]}_${year}.csv`;
            link.click();
        }

        // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Google
        async function connectGoogle() {
            // –ü—Ä–æ—Å—Ç–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ
            const useSimple = confirm('–•–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ü–†–û–°–¢–ò–ô —Å–ø–æ—Å—ñ–±?\n\n‚úÖ –¢–ê–ö - –Ø –¥–æ–ø–æ–º–æ–∂—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)\n‚ùå –ù–Ü - –ü–æ—Ç—Ä—ñ–±–Ω–∞ —Å–∫–ª–∞–¥–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è OAuth');
            
            if (useSimple) {
                showSimpleGoogleSetup();
            } else {
                showOAuthSetup();
            }
        }

        // –ü—Ä–æ—Å—Ç–∏–π —Å–ø–æ—Å—ñ–± - —á–µ—Ä–µ–∑ –≤–µ–±-—Ñ–æ—Ä–º—É
        function showSimpleGoogleSetup() {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 700px;
                max-height: 80vh;
                overflow-y: auto;
            `;
            
            popup.innerHTML = `
                <h2 style="color: #667eea; margin-bottom: 20px;">üöÄ –®–≤–∏–¥–∫–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Google Sheets</h2>
                
                <div style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">‚ö° –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ê –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–Ø</h3>
                    
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">–ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–∞–±–ª–∏—Ü—é</h4>
                        <ol style="line-height: 1.8; margin-left: 20px;">
                            <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "üì• –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ CSV"</li>
                            <li>–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ <a href="https://sheets.google.com" target="_blank" style="color: #667eea;">sheets.google.com</a></li>
                            <li>–§–∞–π–ª ‚Üí –Ü–º–ø–æ—Ä—Ç ‚Üí –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV</li>
                        </ol>
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #10b981; margin-bottom: 10px;">–ö—Ä–æ–∫ 2: –£–≤—ñ–º–∫–Ω—ñ—Ç—å –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é</h4>
                        <ol style="line-height: 1.8; margin-left: 20px;">
                            <li>–£ Google –¢–∞–±–ª–∏—Ü—ñ: –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è ‚Üí Apps Script</li>
                            <li>–í–∏–¥–∞–ª—ñ—Ç—å –≤–µ—Å—å –∫–æ–¥ —Ç–∞ –≤—Å—Ç–∞–≤—Ç–µ –Ω–∞—à —Å–∫—Ä–∏–ø—Ç</li>
                            <li>–ó–±–µ—Ä–µ–∂—ñ—Ç—å —ñ –∑–∞–ø—É—Å—Ç—ñ—Ç—å –æ–¥–∏–Ω —Ä–∞–∑</li>
                            <li>–ì–æ—Ç–æ–≤–æ! –î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –∫–æ–∂–Ω—ñ 5 —Ö–≤</li>
                        </ol>
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                        <p><strong>üìã Apps Script –∫–æ–¥:</strong></p>
                        <textarea readonly onclick="this.select()" style="width: 100%; height: 150px; font-family: monospace; font-size: 12px; padding: 10px; border: 2px solid #ccc; border-radius: 6px; margin-top: 10px;">
function syncFromLocalStorage() {
  // –¶–µ–π —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –≤–µ–±-—Ö—É–∫
  // –ü–æ–∫–∏ —â–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ –µ–∫—Å–ø–æ—Ä—Ç CSV
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —ñ–º–ø–æ—Ä—Ç –∑ CSV –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ñ–∞–π–ª—É
function onOpen() {
  SpreadsheetApp.getUi()
    .createMenu('‚ö° –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è')
    .addItem('üì• –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π CSV', 'importLatestCSV')
    .addToUi();
}
                        </textarea>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button id="exportSimpleBtn" style="padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; margin-right: 10px;">
                        üì• –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ CSV –∑–∞—Ä–∞–∑
                    </button>
                    <button id="openGoogleBtn" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; margin-right: 10px;">
                        üåê –í—ñ–¥–∫—Ä–∏—Ç–∏ Google Sheets
                    </button>
                    <button id="closeSimpleBtn" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">
                        –ó–∞–∫—Ä–∏—Ç–∏
                    </button>
                </div>
            `;

            const overlay = createOverlay();
            document.body.appendChild(overlay);
            document.body.appendChild(popup);

            document.getElementById('exportSimpleBtn').onclick = () => {
                exportToCSV();
                showNotification('‚úì CSV –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ! –¢–µ–ø–µ—Ä —ñ–º–ø–æ—Ä—Ç—É–π—Ç–µ –≤ Google Sheets');
            };

            document.getElementById('openGoogleBtn').onclick = () => {
                window.open('https://sheets.google.com', '_blank');
            };

            document.getElementById('closeSimpleBtn').onclick = () => {
                overlay.remove();
                popup.remove();
            };
        }

        // –°–∫–ª–∞–¥–Ω–∏–π —Å–ø–æ—Å—ñ–± - OAuth
        function showOAuthSetup() {
            showNotification('‚ÑπÔ∏è OAuth –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∏–º–∞–≥–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É –≤ Google Cloud Console', true);
            window.open('https://console.cloud.google.com/apis/credentials', '_blank');
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è overlay
        function createOverlay() {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
            `;
            overlay.onclick = () => {
                overlay.remove();
                document.querySelectorAll('[style*="z-index: 10000"]').forEach(el => el.remove());
            };
            return overlay;
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é
        function showGoogleSetupInstructions() {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
            `;
            
            popup.innerHTML = `
                <h2 style="color: #667eea; margin-bottom: 20px;">üîó –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Google Sheets</h2>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">üìù –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</h3>
                    
                    <ol style="line-height: 1.8;">
                        <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "üì• –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV" –≤–Ω–∏–∑—É</li>
                        <li>–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ <a href="https://sheets.google.com" target="_blank" style="color: #667eea;">sheets.google.com</a></li>
                        <li>–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É —Ç–∞–±–ª–∏—Ü—é (–§–∞–π–ª ‚Üí –°—Ç–≤–æ—Ä–∏—Ç–∏ ‚Üí –¢–∞–±–ª–∏—Ü—é)</li>
                        <li>–§–∞–π–ª ‚Üí –Ü–º–ø–æ—Ä—Ç ‚Üí –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ ‚Üí –≤–∏–±–µ—Ä—ñ—Ç—å CSV —Ñ–∞–π–ª</li>
                        <li>–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä –≤—Å—ñ –¥–∞–Ω—ñ –≤ Google –¢–∞–±–ª–∏—Ü—è—Ö ‚òÅÔ∏è</li>
                    </ol>
                </div>

                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">‚ú® –ü–µ—Ä–µ–≤–∞–≥–∏:</h3>
                    <ul style="line-height: 1.8;">
                        <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è Google</li>
                        <li>‚úÖ –î–æ—Å—Ç—É–ø –∑ –±—É–¥—å-—è–∫–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é</li>
                        <li>‚úÖ –ú–æ–∂–Ω–∞ –¥—ñ–ª–∏—Ç–∏—Å—è –∑ —ñ–Ω—à–∏–º–∏</li>
                        <li>‚úÖ –§–æ—Ä–º—É–ª–∏ Google Sheets –ø—Ä–∞—Ü—é—é—Ç—å</li>
                        <li>‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω</li>
                    </ul>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button id="exportNowBtn" 
                            style="padding: 12px 24px; background: #10b981; color: white; border: none; 
                                   border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">
                        üì• –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ CSV –∑–∞—Ä–∞–∑
                    </button>
                    <button id="closePopupBtn" 
                            style="padding: 12px 24px; background: #6c757d; color: white; border: none; 
                                   border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; margin-left: 10px;">
                        –ó–∞–∫—Ä–∏—Ç–∏
                    </button>
                </div>
            `;

            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
            `;
            overlay.onclick = () => {
                overlay.remove();
                popup.remove();
            };

            document.body.appendChild(overlay);
            document.body.appendChild(popup);

            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
            document.getElementById('exportNowBtn').addEventListener('click', function() {
                overlay.remove();
                popup.remove();
                exportToCSV();
            });

            document.getElementById('closePopupBtn').addEventListener('click', function() {
                overlay.remove();
                popup.remove();
            });
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Google
        async function syncToGoogle() {
            if (!googleSyncEnabled) {
                showNotification('‚ö†Ô∏è Google Sheets –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.', true);
                return;
            }
            
            showNotification('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Google Sheets...');
            await saveData();
            showNotification('‚úì –î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ Google Sheets!');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –¥–∞–Ω–∏—Ö
        let syncTimeout;
        function autoSync() {
            clearTimeout(syncTimeout);
            syncTimeout = setTimeout(() => {
                // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ localStorage —Ç–∞ Google
                saveData();
                console.log('‚úì –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–æ');
            }, 2000); // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏ –ø—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∑–º—ñ–Ω–∏
        }

        // –ï–∫—Å–ø–æ—Ä—Ç –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö —É JSON —Ñ–∞–π–ª
        function exportAllData() {
            const allData = {};
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('timeTracking_')) {
                    allData[key] = localStorage.getItem(key);
                }
            }

            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                data: allData
            };

            const json = JSON.stringify(exportData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `–û–±–ª—ñ–∫_—Ä–æ–±–æ—á–æ–≥–æ_—á–∞—Å—É_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showNotification('‚úì –î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –Ω–∞ –∫–æ–º–ø\'—é—Ç–µ—Ä!');
        }

        // –Ü–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö –∑ JSON —Ñ–∞–π–ª—É
        function importAllData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    if (!importData.data) {
                        showNotification('‚ö† –ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É!', true);
                        return;
                    }

                    if (!confirm('–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∑ —Ñ–∞–π–ª—É? –ü–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ –±—É–¥—É—Ç—å –∑–∞–º—ñ–Ω–µ–Ω—ñ.')) {
                        return;
                    }

                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('timeTracking_')) {
                            keysToRemove.push(key);
                        }
                    }
                    keysToRemove.forEach(key => localStorage.removeItem(key));

                    Object.keys(importData.data).forEach(key => {
                        localStorage.setItem(key, importData.data[key]);
                    });

                    showNotification('‚úì –î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
                    initTable();
                } catch (error) {
                    showNotification('‚ö† –ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É: ' + error.message, true);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        function showNotification(message, isError = false) {
            console.log('showNotification –≤–∏–∫–ª–∏–∫–∞–Ω–æ:', message, isError);
            const notification = document.createElement('div');
            notification.className = 'notification' + (isError ? ' error' : '');
            notification.textContent = message;
            document.body.appendChild(notification);
            console.log('Notification –¥–æ–¥–∞–Ω–æ –¥–æ body:', notification);

            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –±—Ä–∞—É–∑–µ—Ä
        setInterval(saveData, 30000);
    </script>
</body>
</html>